!function(e,a){var t="OMHWebVisualizations";e[t]=a(e,t)}(this,function(e,a){var t,r=e.hasOwnProperty(a)?e[a]:{};return t=function(e,a,t){var r=null,i={},n={ps:1e-9,ns:1e-6,us:.001,ms:1,sec:1e3,min:6e4,h:36e5,d:"d",wk:"w",Mo:"M",yr:"y"},s=function(){var t=JSON.parse(JSON.stringify(e)),i="undefined"!=typeof moment?moment:Date;return r=this.parseOmhData(t,a,i),0===Object.keys(r).length?(console.log("Warning: no data of the specified type could be found."),!1):void 0};return this.resolveKeyPath=function(e,a){if(void 0===e)return e;var t;"string"==typeof a?(i[a]||(i[a]=a.split(".")),t=i[a].slice()):t=a;try{if(a&&t.length>0)return this.resolveKeyPath(e[t.shift()],t)}catch(r){console.info("Exception while resolving keypath",r)}return e},this.getIntervalDisplayDate=function(e,a){var t=e.body.effective_time_frame.time_interval,r=t.start_date_time?new Date(t.start_date_time).getTime():null,i=t.end_date_time?new Date(t.end_date_time).getTime():null,s=t.start_date_time?a(t.start_date_time):null,g=t.end_date_time?a(t.end_date_time):null,o=t.duration?t.duration.value:null;if(o){var u,l=t.duration.unit,D=n[l];"string"!=typeof D?(u=o*D,r||(r=i-u),i||(i=r+u)):(r||(r=g.subtract(o,n[l]).valueOf()),i||(i=s.add(o,n[l]).valueOf()))}return this.getSingleDateForDateRange(r,i)},this.getSingleDateForDateRange=function(e,a){return new Date(e)},this.quantizeDate=function(e,a){var t=a<=OMHWebVisualizations.DataParser.QUANTIZE_MONTH?e.getMonth():6,r=a<=OMHWebVisualizations.DataParser.QUANTIZE_DAY?e.getDate():a===OMHWebVisualizations.DataParser.QUANTIZE_MONTH?15:1,i=a<=OMHWebVisualizations.DataParser.QUANTIZE_HOUR?e.getHours():a===OMHWebVisualizations.DataParser.QUANTIZE_DAY?12:0,n=a<=OMHWebVisualizations.DataParser.QUANTIZE_MINUTE?e.getMinutes():a===OMHWebVisualizations.DataParser.QUANTIZE_HOUR?30:0,s=a<=OMHWebVisualizations.DataParser.QUANTIZE_SECOND?e.getSeconds():a===OMHWebVisualizations.DataParser.QUANTIZE_MINUTE?30:0,g=a<=OMHWebVisualizations.DataParser.QUANTIZE_MILLISECOND?e.getMilliseconds():a===OMHWebVisualizations.DataParser.QUANTIZE_SECOND?500:0;return new Date(e.getFullYear(),t,r,i,n,s,g)},this.parseOmhData=function(e,a,r){var i=this,n={},s={},g={};return e&&0!==e.length?(a.forEach(function(e,a){s[e]=t.getMeasureSettings(e).data.xValueQuantization.period,g[e]=t.getMeasureSettings(e).data.yValuePath}),e.forEach(function(e){e.groupName="",a.forEach(function(a,t){var o=i.resolveKeyPath(e,g[a]);if(void 0!==o&&"object"!=typeof o){e.groupName+="_"+a,n.hasOwnProperty(a)||(n[a]=[]);var u;e.body.effective_time_frame.date_time&&(u=i.quantizeDate(new Date(e.body.effective_time_frame.date_time),s[a])),e.body.effective_time_frame.time_interval&&(u=i.quantizeDate(i.getIntervalDisplayDate(e,r),s[a])),n[a].push({y:o,x:u,provider:e.header.acquisition_provenance.source_name,omhDatum:e,primary:0===t,measure:a})}})}),a.forEach(function(e,a){s[e]!==OMHWebVisualizations.DataParser.QUANTIZE_NONE&&i.aggregateData(e,n)}),n):n},this.aggregateData=function(e,a){var r=t.getMeasureSettings(e).data.xValueQuantization.aggregator;r(a[e])},this.getMeasureData=function(e){return r[e]},this.getAllMeasureData=function(){return r},this.hasMeasureData=function(e){return r.hasOwnProperty(e)},s.call(this)},t.QUANTIZE_YEAR=6,t.QUANTIZE_MONTH=5,t.QUANTIZE_DAY=4,t.QUANTIZE_HOUR=3,t.QUANTIZE_MINUTE=2,t.QUANTIZE_SECOND=1,t.QUANTIZE_MILLISECOND=0,t.QUANTIZE_NONE=-1,t.aggregators={},t.aggregators.sum=function(e){e.sort(function(e,a){return e.x.getTime()-a.x.getTime()});for(var a=0;a<e.length;a++){for(;a+1<e.length&&e[a+1].x.getTime()===e[a].x.getTime();)e[a].y+=e[a+1].y,e[a].aggregatedData||(e[a].aggregatedData=[e[a].omhDatum]),e[a].aggregatedData.push(e[a+1].omhDatum),e.splice(a+1,1);e[a].aggregationType="sum"}},t.aggregators.mean=function(e){r.DataParser.aggregators.sum(e);for(var a=0;a<e.length;a++){var t=e[a].aggregatedData?e[a].aggregatedData.length:0;t>0&&(e[a].y/=t,e[a].aggregationType="mean")}},t.aggregators.median=function(e){e.sort(function(e,a){return e.x.getTime()-a.x.getTime()});for(var a=0;a<e.length;a++){for(var t=[e[a].y];a+1<e.length&&e[a+1].x.getTime()===e[a].x.getTime();)e[a].aggregatedData||(e[a].aggregatedData=[e[a].omhDatum]),t.push(e[a+1].y),e[a].aggregatedData.push(e[a+1].omhDatum),e.splice(a+1,1);e[a].aggregationType="median",e[a].y=t[parseInt(e[a].aggregatedData.length/2)]}},r.DataParser=t,r});